《NP-Middle-Language》项目文档
一、项目概述
1.1 项目背景
大模型时代，AI编程、Vide coding成为新型编程范式——采用自然语言与编程AI助手交流，实现编程任务。整体来看，该编程范式直接通过自然语言编程，间接地将自然语言提升为“编程语言”，极大地降低了开发门槛。
但是自然语言天生不是为编程服务的，换句话说，自然语言难以描述复杂的程序逻辑，自然语言的细腻程度难以在编程语境下掌握——是宏观地描述具体需要实现的功能？还是微观地描述功能如何实现？同时，自然语言的歧义性导致每次AI生成的代码程序是不一致的，即“自然语言编程”难以实现唯一性。
总的来说，自然语言编程有以下局限性：
1.自然语言难以描述复杂程序逻辑；
2.自然语言难以把握描述细腻程度；
3.自然语言具有歧义，无法保证每次代码生成是确定的。
1.2 项目目标
本项目为了解决1.1所述的3个自然语言编程局限性，提出一种介于自然语言和高级编程语言的新编程语言，或者说标记语言，命名为NP-middle-Language。
该语言一定程度上可以视为编程语言，也可以称为标记语言，为了统一，本项目将该语言视为编程语言。
NP-Middle-Language（下文简称NPML）将混合自然语言和一定高级编程语言语法，理论上具备自然语言的自由性和高级编程语言的严谨性。NPML的目的是引导编程AI生成无歧义、确定的高级编程语言代码。
NPML与伪代码相似，但是NPML比高级编程语言更简单，比伪代码更灵活。

二、NPML的基本概念
2.1 翻译器
每门编程语言都有其编译器或者解释器，对于静态语言，一般通过编译器编译为可执行文件（C/C++、golang、rust）；对于动态语言，一般通过解释器翻译为字节码，在运行时上运行（java、python）。
NPML的编译器或者解释器直接来讲应该是AI本身，更具体一点：可生成目标高级编程语言的文字大模型。为了方便，本项目将该文字大模型称为编程AI。编程AI将NPML翻译为对应目标高级编程语言，然后调用该高级编程语言的编译器或者解释器。
NPML翻译器定义为：可以将NPML代码转化为目标编程语言的编程AI。
2.2 弱语法约束
NPML不是严格意义上的编程语言，而是混合自然语言和编程语言的标记类语言，也就是说NPML没有强力的语法约束，也不关心语法导致的程序安全、效率问题，只关注：程序的执行效果和程序的执行流程方式。
三、NPML设计
3.1 项目架构
每个项目开始时都需要确定整个项目的架构，具体而言就是项目的目录结构。为了引导翻译器感知整个项目架构，和正确生成代码文件，NPML引入项目架构描述文件：npml_arch.md。
架构描述文件里面会指明当前项目的目录架构，包括有哪些文件夹、文件，新的文件夹和文件应该放在哪里。文件夹和文件的命名约定。
架构描述文件有开发者和翻译器共同维护，需要定期及时更新，防止翻译器误解项目架构。
3.2 NPML优化
翻译器生成代码后，可以反向优化原NPML代码，使更符合代码，保持一致性。


四、NPML翻译器
4.1 目前结合智能体Agent的翻译器问题
经过实际开发，发现结合编程智能体Agent实现的NPML翻译器有诸多问题，其中是Agent自身的问题，还有是NPML翻译器设计问题。
一是Agent的主观能动性过高，不遵从最小实现原则，脱离NPML代码实现多余的功能。二是Agent在非热门的框架使用上，效果很差。三是文档引用语法不合理，使用不清晰。四是Agent模式可能不适合作为翻译器。
4.2 解决方案
对于问题一，实际上与问题四是同一类问题：Agent模式不适合作为NPML的翻译器。翻译器只需要实现如下功能：接收NPML代码和其引用文件（文档、其他代码），翻译并输出目标编程语言代码（或者文件），反向优化NPML代码。
Agent模式能够实现翻译器的功能，但是它不只是能够实现翻译器的功能，它还具备自主工具使用、环境感知等，过高的主观能动性影响类翻译器的本质功能。所以Agent模式不适合作为NPML的翻译器。
事实上，只需要将NPML代码和其相关文件一起发送给翻译器即可，而发生内容的构建可以由程序实现。
对于问题二和问题三，需要增强文档的导入，丰富文档库，保证翻译器正确感知整个项目和框架的使用。
4.3 NPML翻译请求文（NPML request context）
本项目将NPML翻译器的职责进行精简，现在翻译器的任务为：接收NPML代码，输出NPML翻译请求文。将该NPML翻译请求文提交给任意擅长CODE的大模型AI，AI即可生成目标编程代码。用户可以自行创建从NPML代码到目标编程代码的端到端程序，只需要在翻译器下游添加对应程序即可。
NPML翻译请求文默认以markdown方式存储，这符合人类阅读，也方便AI解析。NPML翻译请求文的内容如下：
NPML代码；
项目结构说明；
文档引用；
代码引用。

上面的四个子内容开头为对应子内容标题加冒号，正文下一行。
同一子内容里面的多个代码、文档用---隔开，并在开头以//[文件路径/文件名]指明文件名。
项目结构说明即项目目录树，由程序自动生成。
4.4 翻译流程
首先给NPML代码标上行号，便于AI定位行号；
将NPML代码中出现的引用语法标识!(file_path)中的引用内容添加到后续的文档引用或者代码引用中；
生成项目目录树作为项目结构说明。
